{% extends 'base_dashboard.html' %} 
{% load static %}
{% load humanize %} 

{% block dashboard_content %}
<h1 class="listagem-titulo">üóìÔ∏è Gerenciar Minha Agenda</h1>

<p>Aqui voc√™ define seus hor√°rios de trabalho semanais e gerencia folgas ou plant√µes extras. As consultas ser√£o agendadas em *slots* de **{{ duracao_consulta }} minutos**.</p>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<div class="row-container">
    
    <div class="col-6">
        <h2 class="section-title">‚è∞ Hor√°rios Recorrentes (Padr√£o Semanal)</h2>
        
        <div class="card p-4 mb-4">
            <h4>Adicionar Novo Turno</h4>
            <form method="post" class="form-agenda">
                {% csrf_token %}
                
                {% for hidden in form_horario.hidden_fields %}
                    {{ hidden }}
                {% endfor %}

                <div class="form-group">
                    <label>{{ form_horario.dia_semana.label }}</label>
                    {{ form_horario.dia_semana }}
                    {% if form_horario.dia_semana.errors %}<div class="error-message">{{ form_horario.dia_semana.errors }}</div>{% endif %}
                </div>

                <div class="form-group-inline">
                    <div class="form-field-half">
                        <label>{{ form_horario.hora_inicio.label }}</label>
                        {{ form_horario.hora_inicio }}
                        {% if form_horario.hora_inicio.errors %}<div class="error-message">{{ form_horario.hora_inicio.errors }}</div>{% endif %}
                    </div>
                    <div class="form-field-half">
                        <label>{{ form_horario.hora_fim.label }}</label>
                        {{ form_horario.hora_fim }}
                        {% if form_horario.hora_fim.errors %}<div class="error-message">{{ form_horario.hora_fim.errors }}</div>{% endif %}
                    </div>
                </div>
                
                {% if form_horario.non_field_errors %}
                    <div class="error-message non-field-error">
                        {% for error in form_horario.non_field_errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}

                <button type="submit" class="btn btn-primary mt-3">Salvar Hor√°rio</button>
            </form>
        </div>

        <h4 class="mt-4">Turnos Cadastrados:</h4>
        {% if horarios %}
            <ul class="list-horarios">
                {% for horario in horarios %}
                    <li>
                        <span><strong>{{ horario.get_dia_semana_display }}</strong>: {{ horario.hora_inicio|time:"H:i" }} - {{ horario.hora_fim|time:"H:i" }}</span>
                        <div class="list-actions">
                            <a href="{% url 'editar_horario' horario.pk %}" class="btn-edit-small">Editar</a>
                            <a href="{% url 'deletar_horario' horario.pk %}" class="btn-delete-small">Remover</a>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="info-message">Nenhum hor√°rio recorrente cadastrado.</p>
        {% endif %}
    </div>
    
    <div class="col-6">
        <h2 class="section-title">üö® Pr√≥ximas Exce√ß√µes e Aus√™ncias</h2>
        
        <a href="{% url 'adicionar_excecao' %}" class="btn btn-secondary mb-3">Adicionar Nova Exce√ß√£o/Aus√™ncia</a>
        
        {% if excecoes %}
            <ul class="list-excecoes">
                {% for excecao in excecoes %}
                    <li class="{% if excecao.esta_bloqueado %}excecao-bloqueio{% else %}excecao-extra{% endif %}">
                        <div class="excecao-info">
                            <strong>
                                {% if excecao.esta_bloqueado %}üö´ Bloqueio:{% else %}‚ú® Extra:{% endif %}
                            </strong> 
                            <br>
                            De: {{ excecao.data_inicio|date:"d/m/Y H:i" }} <br>
                            At√©: {{ excecao.data_fim|date:"d/m/Y H:i" }}
                            <p class="motivo-text">Motivo: {{ excecao.motivo }}</p>
                        </div>
                        <div class="list-actions">
                            <a href="{% url 'editar_excecao' excecao.pk %}" class="btn-edit-small">Editar</a>
                            <a href="{% url 'deletar_excecao' excecao.pk %}" class="btn-delete-small">Remover</a>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="info-message">Nenhuma exce√ß√£o ou aus√™ncia futura cadastrada.</p>
        {% endif %}
    </div>

</div>

<style>
/* Estrutura B√°sica */
.row-container {
    display: flex;
    gap: 30px;
}
.col-6 {
    flex: 1;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: white;
}
.section-title {
    border-bottom: 2px solid #007bff;
    padding-bottom: 5px;
    margin-bottom: 20px;
    font-size: 1.5em;
    color: #333;
}

/* Formul√°rio e Campos */
.card {
    border: 1px solid #007bff;
    border-radius: 6px;
}
.form-agenda .form-group {
    margin-bottom: 15px;
}
.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}
.form-group-inline {
    display: flex;
    gap: 10px;
}
.form-field-half {
    flex: 1;
}
.form-control {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

/* Listas de Hor√°rios e Exce√ß√µes */
.list-horarios, .list-excecoes {
    list-style: none;
    padding: 0;
}
.list-horarios li, .list-excecoes li {
    padding: 10px 15px;
    margin-bottom: 8px;
    border: 1px solid #f0f0f0;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Estilos de Exce√ß√£o */
.excecao-bloqueio {
    background-color: #ffe0e0; /* Vermelho claro */
    border-left: 5px solid #dc3545;
}
.excecao-extra {
    background-color: #e0fff3; /* Verde/Ciano claro */
    border-left: 5px solid #28a745;
}
.excecao-info {
    flex-grow: 1;
}
.motivo-text {
    font-size: 0.9em;
    color: #6c757d;
    margin-top: 5px;
    margin-bottom: 0;
}

/* Bot√µes */
.list-actions {
    display: flex;
    gap: 5px;
}
.btn {
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    text-decoration: none;
    display: inline-block;
}
.btn-primary {
    background-color: #007bff;
    color: white;
}
.btn-secondary {
    background-color: #6c757d;
    color: white;
}
.btn-delete-small, .btn-edit-small {
    font-size: 0.8em;
    padding: 3px 8px;
    border-radius: 3px;
    text-decoration: none;
    transition: background-color 0.3s;
}
.btn-delete-small {
    color: #dc3545;
    border: 1px solid #dc3545;
}
.btn-delete-small:hover {
    background-color: #dc3545;
    color: white;
}
.btn-edit-small {
    color: #ffc107;
    border: 1px solid #ffc107;
}
.btn-edit-small:hover {
    background-color: #ffc107;
    color: #333;
}

/* Mensagens e Erros */
.alert {
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 4px;
}
.alert-success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
.alert-error, .error-message, .non-field-error { 
    color: #721c24; 
    background-color: #f8d7da; 
    border-color: #f5c6cb; 
    padding: 5px;
    border-radius: 4px;
}
.info-message {
    padding: 10px;
    background-color: #e2e3e5;
    border: 1px solid #d6d8db;
    border-radius: 4px;
}
</style>

{% endblock %}